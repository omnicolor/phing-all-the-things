<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PHING ALL THE THINGS!</title>
    <link rel="stylesheet" href="deck.js/core/deck.core.css">
    <link rel="stylesheet" href="deck.js/themes/style/web-2.0.css">
    <link rel="stylesheet" href="deck.js/themes/transition/horizontal-slide.css">
    <link rel="stylesheet" href="deck.js/extensions/status/deck.status.css">
    <link rel="stylesheet" href="google-code-prettify/src/prettify.css">
    <link rel="stylesheet/less" href="styles.less">
    <script src="less-1.3.1.min.js"></script>
    <script src="deck.js/modernizr.custom.js"></script>
</head>

<body>

<section class="slide title">
    <h1>Phing all the things!</h1>
</section>

<section class="slide about-me">
    <div class="centered">
        <img alt="Omni Adams" class="pull-left" src="images/omni-simpson.jpg">
        <ul class="pull-right">
            <li>Omni Adams</li>
            <li>@omnicolor</li>
            <li>http://omni-spot.blogspot.com</li>
            <li>omni@digitaldarkness.com</li>
            <li>Lazy development</li>
        </ul>
    </div>
    <ul class="note">
        <li>1st, a little about me</li>
        <li>my name is</li>
        <li>find me on the twitter</li>
        <li>check out my blog</li>
        <li>feel free to email me</li>
        <li>
            a few things about this talk
            <ol>
                <li>I try to be funny, it's okay to laugh</li>
                <li>If you're easily offended</li>
                <li>Feel free to ask questions</li>
            </ol>
        </li>
    </ul>
</section>

<section class="slide lazy-development-0">
    <h1>Lazy development</h1>
    <ul class="note">
        <li>I specialize in lazy development</li>
        <li>What is lazy development you ask?</li>
    </ul>
</section>

<section class="slide lazy-development-1">
    <img alt="sleeping cat" class="centered"
        src="images/scriptlet-sleeping.jpg">
    <ul class="note">
        <li>Lazy development lets you stop wasting time</li>
        <li>get back to what's important</li>
        <li>like petting your cat</li>
        <li>or taking a nap</li>
    </ul>
</section>

<section class="slide dry-0">
    <h1>Stay <span>DRY</span></h1>
    <ul class="note">
        <li>Hopefully you've heard DRY</li>
        <li>Don't repeat yourself</li>
        <li>Lemme say that again</li>
        <li>DO NOT REPEAT YOURSELF</li>
    </ul>
</section>

<section class="slide dry-1">
    <img alt="http://ardalis.com/DRY---Don%E2%80%99t-Repeat-Yourself---Motivator"
        class="centered" src="images/dont_repeat.jpg">
    <ul class="note">
        <li>Start small with phing</li>
        <li>Choose something you do all the time</li>
        <li>I assume you're all writing tests...</li>
        <li>So we'll start with getting phing to run phpunit</li>
    </ul>
</section>

<section class="slide phpunit-0">
    <pre class="prettyprint">
    &lt;?xml version="1.0" encoding=&quot;UTF-8&quot;?&gt;
    &lt;project name=&quot;phing-the-things&quot;&gt;
        &lt;target name=&quot;test&quot;&gt;
            &lt;exec executable="phpunit" passthru="true" checkreturn="true" /&gt;
        &lt;/target&gt;
    &lt;/project&gt;
    </pre>
    <ul class="note">
        <li>Here's a really simple build.xml file</li>
        <li>Your most basic phing building block is the target</li>
        <li>Targets do things</li>
        <li>... or do logic</li>
        <li>... or set variables (which we'll get to)</li>
        <li>In this case the target calls one task: exec</li>
        <li>That calls the phpunit executable</li>
    </ul>
</section>

<section class="slide phpunit-1">
    <pre class="prettyprint">
    <span class="highlight">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    &lt;project name=&quot;phing-the-things&quot;&gt;
        &lt;target name=&quot;test&quot;&gt;
            &lt;exec executable="phpunit" passthru="true" checkreturn="true" /&gt;
        &lt;/target&gt;
    &lt;/project&gt;
    </pre>
    <ul class="note">
        <li>First, we have the standard XML stuff</li>
        <li>phing is all enterprisey and uses XML</li>
        <li>Hey, it could be worse, it could be java</li>
        <li>Phing is a pretty close port of Apache ANT, which uses XML</li>
    </ul>
</section>

<section class="slide phpunit-2">
    <pre class="prettyprint">
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    <span class="highlight">&lt;project name=&quot;phing-the-things&quot;&gt;</span>
        &lt;target name=&quot;test&quot;&gt;
            &lt;exec executable="phpunit" passthru="true" checkreturn="true" /&gt;
        &lt;/target&gt;
    <span class="highlight">&lt;/project&gt;</span>
    </pre>
    <ul class="note">
        <li>And you have the project tags that surround your tasks</li>
        <li>I'll leave these out of the future slides</li>
    </ul>
</section>

<section class="slide phpunit-3">
    <pre class="prettyprint">
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;project name=&quot;phing-the-things&quot;&gt;
        <span class="highlight">&lt;target name=&quot;test&quot;&gt;</span>
            &lt;exec executable="phpunit" passthru="true" checkreturn="true" /&gt;
        <span class="highlight">&lt;/target&gt;</span>
    &lt;/project&gt;
    </pre>
    <ul class="note">
        <li>Then the actual target tag</li>
        <li>We'll cover this more in depth as well later</li>
        <li>For now, know that the name is what you use to call it with</li>
    </ul>
</section>

<section class="slide phpunit-4">
    <pre class="prettyprint">
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;project name=&quot;phing-the-things&quot;&gt;
        &lt;target name=&quot;test&quot;&gt;
            <span class="highlight">&lt;exec executable="phpunit" passthru="true" checkreturn="true" /&gt;</span>
        &lt;/target&gt;
    &lt;/project&gt;
    </pre>
    <ul class="note">
        <li>Finally, the exec tag that actually does the work</li>
        <li>This is called a task in phing terminology</li>
        <li>There are a bunch of fancy tasks pre-written</li>
        <li>You can write new ones</li>
        <li>exec is a very powerful task if you're CLI-inclined</li>
        <li>I'll show some more complicated execs later</li>
        <li>There is a phpunit task, but it is pretty limited</li>
    </ul>
</section>

<section class="slide phpunit-5">
<pre class="cli">$ phing test
<span class="notice">Buildfile: /Users/Omni/phing-example/build.xml
 [property] Loading /Users/Omni/phing-example/build.properties</span>

phing-example &gt; test:

PHPUnit 3.7.13 by Sebastian Bergmann.

Configuration read from /Users/Omni/phing-example/phpunit.xml

..............................

Time: 0 seconds, Memory: 7.25Mb

<span class="invert-pass">OK (30 tests, 52 assertions)</span>

<span class="pass">BUILD FINISHED

Total time: 0.3155 seconds</span></pre>
    <ul class="note">
        <li>Now, if you type phing test it will run your task</li>
        <li>and hopefully you'll get some pretty success messages</li>
    </ul>
</section>

<section class="slide phpunit-6">
<pre class="cli"><span class="invert-fail">F</span>.............................

Time: 0 seconds, Memory: 7.25Mb

There was 1 failure:

1) GitTest::testGetCommitInfo
LOL cats have clogged the tubes!

/Users/Omni/phing-example/tests/GitTest.php:51

<span class="invert-fail">FAILURES!
Tests: 30, Assertions: 51, Failures: 1.</span>
<span class="fail">
Execution of target "test" failed for the following reason: /Users/Omni/phing-example/build.xml:102:46: Task exited with code 1

BUILD FAILED
/Users/Omni/phing-example/build.xml:102:46: Task exited with code 1
Total time: 0.5653 seconds</span></pre>
    <ul class="note">
        <li>If you have a failing test, you'll get something more like this</li>
    </ul>
</section>

<section class="slide phpunit-7">
    <pre class="prettyprint">
    &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
    &lt;project name=&quot;phing-the-things&quot;&gt;
        &lt;target name=&quot;test&quot;&gt;
            &lt;exec executable="phpunit" passthru="true" <span class="highlight strike">checkreturn="true"</span> /&gt;
        &lt;/target&gt;
    &lt;/project&gt;
    </pre>
    <ul class="note">
        <li>Remember that checkreturn attribute earlier?</li>
        <li>Here's what happens if you leave it off</li>
        <li>Or you set it to false</li>
    </ul>
</section>

<section class="slide phpunit-8">
<pre class="cli"><span class="invert-fail">F</span>.............................

Time: 0 seconds, Memory: 7.25Mb

There was 1 failure:

1) GitTest::testGetCommitInfo
LOL cats have clogged the tubes!

/Users/Omni/phing-example/tests/GitTest.php:51

<span class="invert-fail">FAILURES!
Tests: 30, Assertions: 51, Failures: 1.</span>

<span class="pass">BUILD FINISHED

Total time: 0.5619 seconds</span></pre>
    <ul class="note">
        <li>The PHPunit task should fail a build if it fails</li>
        <li>Here you can see the tests failed, but the build passed</li>
        <li>The phpunit task fails the build, but the exec doesn't</li>
    </ul>
</section>

<section class="slide lolwut-phpunit">
    <img alt="LOLWUT?" class="centered" src="images/lolwut.jpg">
    <ul class="note">
        <li>So if you have to add this extra attribute to get sane behavior...</li>
        <li>The phpunit task is limited in what you can configure</li>
    </ul>
</section>

<section class="slide phpunit-vs-exec">
    <ul>
        <li>strict</li>
        <li>colors</li>
        <li>groups</li>
        <li>command line flags</li>
    </ul>
    <ul class="note">
        <li>Here's some things that the phpunit task doesn't seem to support</li>
        <li>strict for catching tests with no assertions</li>
        <li>colors for prettier output</li>
        <li>groups for targetting tests</li>
        <li>and command line flags for changing behavior at run time</li>
        <li>If you don't care about these, use the real task</li>
    </ul>
</section>

<section class="slide more-phpunit">
    <pre class="prettyprint">
    &lt;target name=&quot;test&quot;&gt;
        &lt;exec executable=&quot;phpunit&quot; passthru=&quot;true&quot; checkreturn=&quot;true&quot;&gt;
            <span class="highlight">&lt;arg value=&quot;--exclude-group=integration&quot; /&gt;</span>
        &lt;/exec&gt;
    &lt;/target&gt;
    </pre>
    <ul class="note">
        <li>One argument I like to be able to include</li>
        <li>exclude-group (or include-group)</li>
        <li>Lets you target tests with @group annotations</li>
        <li>So you can organize your tests a bit</li>
        <li>Like smoke, integration, selenium, or whatever</li>
    </ul>
</section>

<section class="slide even-more-phpunit">
    <pre class="prettyprint">
    &lt;target name=&quot;test&quot;&gt;
        &lt;exec executable=&quot;phpunit&quot; passthru=&quot;true&quot; checkreturn=&quot;true&quot;&gt;
            <span class="highlight">&lt;arg value=&quot;${phpunitFlag}&quot; /&gt;</span>
        &lt;/exec&gt;
    &lt;/target&gt;
    </pre>
    <ul class="note">
        <li>Another that's pretty helpful is a flag</li>
        <li>This lets you modify phpunit behavior while running phing</li>
    </ul>
</section>

<section class="slide properties-0">
    <img alt="Find X" class="centered" src="images/findX.gif">
    <ul class="note">
        <li>Variables are called properties in Phing</li>
        <li>There's a few ways of setting them</li>
    </ul>
</section>

<section class="slide properties-1">
    <pre class="prettyprint">
    &lt;property name=&quot;phpunitFlag&quot; value=&quot;--group=smoke&quot; /&gt;
    </pre>
    <ul class="note">
        <li>One way is with a property line in your build file</li>
        <li>This is useful for setting paths to things</li>
        <li>For example, you can default a path to a sane value</li>
        <li>but allow other developers to easily override it if needed</li>
        <li>We'll get into how a little later</li>
    </ul>
</section>

<section class="slide properties-2">
    <pre class="cli">$ phing test -DphpunitFlag=--group=smoke
<span class="notice">Buildfile: /Users/Omni/phing-example/build.xml
 [property] Loading /Users/Omni/phing-example/build.properties</span>

phing-example &gt; test:

PHPUnit 3.7.13 by Sebastian Bergmann.

Configuration read from /Users/Omni/phing-example/phpunit.xml

........

Time: 0 seconds, Memory: 7.25Mb

<span class="invert-pass">OK (8 tests, 12 assertions)</span>

<span class="pass">BUILD FINISHED

Total time: 0.1058 seconds</span></pre>
    <ul class="note">
        <li>Another way is from the command line</li>
        <li>Yeah, it's ugly</li>
        <li>That's the Java heritage for you</li>
    </ul>
</section>

<section class="slide properties-3">
    <pre>composer=/opt/composer.phar
docdir=/home/omni/Documents/coverage
server1.user=oadams
server1.url=www.example.lan</pre>
    <pre class="prettyprint">
    &lt;property file=&quot;build.properties&quot; /&gt;
    &lt;exec executable=&quot;${composer}" /&gt;
    &lt;exec executable=&quot;ssh" passthru="true"&gt;
        &lt;arg value=&quot;-t&quot; /&gt;
        &lt;arg value=&quot;${server1.user}@${server1.url}&quot; /&gt;
        &lt;arg value=&quot;sudo /sbin/service httpd restart&quot; /&gt;
    &lt;/exec&gt;</pre>
    <ul class="note">
        <li>Another way of setting properties is build.properties</li>
        <li>Simple name equals value text file</li>
        <li>Probably should be ignored in your source control</li>
        <li>At the top you see an example build.properties</li>
        <li>Each of these are usable in your build file</li>
        <li>This first exec shows how to set where your composer.phar is</li>
        <li>
            The second shows using a user and hostname to restart apache with
            SSH
        </li>
        <li>We'll get more into this sort of advanced magic later</li>
    </ul>
</section>

<section class="slide properties-4">
    <div id="first">first</div>
    <div id="things">things</div>
    <div id="second">first</div>
    <ul class="note">
        <li>One thing that can easily trip you up</li>
        <li>Properties are mostly immutable</li>
        <li>There are a few exceptions to this run, and we'll get to those</li>
    </ul>
</section>

<section class="slide properties-5">
    <pre># build.properties
foo=test
bar=test</pre>
    <pre class="prettyprint">    &lt;property name=&quot;foo&quot; value=&quot;bar&quot; /&gt;
    &lt;property file=&quot;build.properties&quot; /&gt;
    &lt;property name=&quot;mitz&quot; value=&quot;fah&quot; /&gt;
    </pre>
    <ul class="note">
        <li>If you don't put your build.properties file first, it doesn't</li>
        <li>
            So in this case, you might think build.properties sets both to test
        </li>
        <li>But the foo property has already been set, so it is still 'bar'</li>
        <li>While the mitz value is set to 'test'</li>
        <li>This does let you control which variables can be overridden</li>
        <li>If you set some before build.properties is included, they're set</li>
        <li>Those set after it's included can be changed by the user</li>
    </ul>
</section>

<section class="slide filesets-0">
    <img alt="Smelly feet" class="centered" src="images/cat-feet.jpg">
    <ul class="note">
        <li>Any of y'all use PHP code sniffer?</li>
        <li>It's a tool that sniffs your code to find possible problems</li>
        <li>
            If you use any third-party libraries, your phpcs may have irrelevant
            warnings
        </li>
        <li>One way to fix that is with filesets</li>
    </ul>
</section>

<section class="slide filesets-1">
    <pre class="prettyprint">
    &lt;patternset id=&quot;<span class="highlight">files</span>&quot;&gt;
        &lt;include name=&quot;**/*.php&quot; /&gt;
        &lt;exclude name=&quot;third-party/**&quot; /&gt;
        &lt;exclude name=&quot;vendor/**&quot; /&gt;
    &lt;/patternset&gt;
    &lt;target name=&quot;phpcs&quot;&gt;
        &lt;phpcodesniffer standard=&quot;./coding_rules.xml&quot; format=&quot;full&quot;
                showWarnings=&quot;true&quot;&gt;
            &lt;fileset dir=&quot;.&quot;&gt;
                &lt;patternset refid=&quot;<span class="highlight">files</span>&quot; /&gt;
            &lt;/fileset&gt;
        &lt;/phpcodesniffer&gt;
    &lt;/target&gt;</pre>
    <ul class="note">
        <li>Here we define a patternset and call it files</li>
        <li>We include everything in our project directory that ends in php</li>
        <li>
            But exclude everything in third-party and any composer dependencies
        </li>
        <li>
            The fileset used in phpcs references the patternset we defined above
        </li>
        <li>Very useful for this use case since you may want to run static</li>
        <li>Most of the tools Germans write to say you're doing it wrong</li>
    </ul>
</section>

<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<script src="deck.js/jquery-1.7.2.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script src="deck.js/extensions/hash/deck.hash.js"></script>
<script src="google-code-prettify/src/prettify.js"></script>
<script src="phing.js"></script>
</body>
</html>
